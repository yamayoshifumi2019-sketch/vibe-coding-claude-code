<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Platformer Game</title>
    <style>
        /* Center the canvas on the page */
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            background-color: #333;
        }
        canvas {
            border: 4px solid #fff;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <script>
        // ============================================
        // GAME SETUP
        // ============================================

        // Get the canvas and its 2D drawing context
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game state
        let gameCleared = false;

        // ============================================
        // PLAYER OBJECT
        // ============================================

        const player = {
            x: 50,              // Starting X position
            y: 500,             // Starting Y position
            width: 40,          // Player width
            height: 40,         // Player height
            color: '#FF6B6B',   // Player color (red)

            // Movement properties
            velocityX: 0,       // Horizontal speed
            velocityY: 0,       // Vertical speed
            speed: 5,           // Movement speed
            jumpForce: -15,     // Jump strength (negative = up)
            gravity: 0.8,       // Gravity strength

            // State
            isOnGround: false   // Is player standing on something?
        };

        // ============================================
        // PLATFORMS ARRAY
        // ============================================

        // Each platform has: x, y, width, height, color
        const platforms = [
            // Ground (bottom of screen)
            { x: 0, y: 560, width: 800, height: 40, color: '#8B4513' },

            // Floating platforms
            { x: 100, y: 450, width: 150, height: 20, color: '#4ECDC4' },
            { x: 350, y: 380, width: 150, height: 20, color: '#4ECDC4' },
            { x: 550, y: 300, width: 150, height: 20, color: '#4ECDC4' },
            { x: 250, y: 220, width: 150, height: 20, color: '#4ECDC4' },
            { x: 500, y: 150, width: 120, height: 20, color: '#4ECDC4' }
        ];

        // ============================================
        // GOAL OBJECT
        // ============================================

        const goal = {
            x: 540,             // Goal X position
            y: 100,             // Goal Y position
            width: 50,          // Goal width
            height: 50,         // Goal height
            color: '#FFD93D'    // Goal color (yellow)
        };

        // ============================================
        // INPUT HANDLING
        // ============================================

        // Track which keys are currently pressed
        const keys = {
            left: false,
            right: false,
            space: false
        };

        // Listen for key presses
        document.addEventListener('keydown', (event) => {
            if (event.code === 'ArrowLeft') keys.left = true;
            if (event.code === 'ArrowRight') keys.right = true;
            if (event.code === 'Space') {
                keys.space = true;
                event.preventDefault(); // Prevent page scrolling
            }
        });

        // Listen for key releases
        document.addEventListener('keyup', (event) => {
            if (event.code === 'ArrowLeft') keys.left = false;
            if (event.code === 'ArrowRight') keys.right = false;
            if (event.code === 'Space') keys.space = false;
        });

        // ============================================
        // COLLISION DETECTION
        // ============================================

        // Check if two rectangles are overlapping
        function isColliding(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        // ============================================
        // GAME UPDATE FUNCTION
        // ============================================

        function update() {
            // Don't update if game is cleared
            if (gameCleared) return;

            // --- Horizontal Movement ---
            if (keys.left) {
                player.velocityX = -player.speed;
            } else if (keys.right) {
                player.velocityX = player.speed;
            } else {
                player.velocityX = 0;
            }

            // --- Jumping ---
            // Only jump if on the ground and space is pressed
            if (keys.space && player.isOnGround) {
                player.velocityY = player.jumpForce;
                player.isOnGround = false;
            }

            // --- Apply Gravity ---
            player.velocityY += player.gravity;

            // --- Move Player ---
            player.x += player.velocityX;
            player.y += player.velocityY;

            // --- Keep Player Inside Canvas (Left/Right) ---
            if (player.x < 0) {
                player.x = 0;
            }
            if (player.x + player.width > canvas.width) {
                player.x = canvas.width - player.width;
            }

            // --- Platform Collision Detection ---
            player.isOnGround = false;

            for (const platform of platforms) {
                if (isColliding(player, platform)) {
                    // Calculate overlap on each side
                    const overlapLeft = (player.x + player.width) - platform.x;
                    const overlapRight = (platform.x + platform.width) - player.x;
                    const overlapTop = (player.y + player.height) - platform.y;
                    const overlapBottom = (platform.y + platform.height) - player.y;

                    // Find the smallest overlap to determine collision side
                    const minOverlap = Math.min(overlapLeft, overlapRight, overlapTop, overlapBottom);

                    // Resolve collision based on smallest overlap
                    if (minOverlap === overlapTop && player.velocityY > 0) {
                        // Landing on top of platform
                        player.y = platform.y - player.height;
                        player.velocityY = 0;
                        player.isOnGround = true;
                    } else if (minOverlap === overlapBottom && player.velocityY < 0) {
                        // Hitting bottom of platform
                        player.y = platform.y + platform.height;
                        player.velocityY = 0;
                    } else if (minOverlap === overlapLeft) {
                        // Hitting left side of platform
                        player.x = platform.x - player.width;
                    } else if (minOverlap === overlapRight) {
                        // Hitting right side of platform
                        player.x = platform.x + platform.width;
                    }
                }
            }

            // --- Check Goal Collision ---
            if (isColliding(player, goal)) {
                gameCleared = true;
            }
        }

        // ============================================
        // GAME DRAW FUNCTION
        // ============================================

        function draw() {
            // --- Clear the Canvas ---
            ctx.fillStyle = '#87CEEB'; // Sky blue background
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // --- Draw Platforms ---
            for (const platform of platforms) {
                ctx.fillStyle = platform.color;
                ctx.fillRect(platform.x, platform.y, platform.width, platform.height);
            }

            // --- Draw Goal ---
            ctx.fillStyle = goal.color;
            ctx.fillRect(goal.x, goal.y, goal.width, goal.height);

            // Draw star symbol on goal
            ctx.fillStyle = '#FF8C00';
            ctx.font = '30px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('★', goal.x + goal.width / 2, goal.y + 37);

            // --- Draw Player ---
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);

            // Draw simple eyes on player
            ctx.fillStyle = 'white';
            ctx.fillRect(player.x + 8, player.y + 10, 8, 8);
            ctx.fillRect(player.x + 24, player.y + 10, 8, 8);
            ctx.fillStyle = 'black';
            ctx.fillRect(player.x + 12, player.y + 12, 4, 4);
            ctx.fillRect(player.x + 28, player.y + 12, 4, 4);

            // --- Draw Instructions ---
            ctx.fillStyle = 'white';
            ctx.font = '16px Arial';
            ctx.textAlign = 'left';
            ctx.fillText('← → : Move   Space : Jump', 10, 25);
            ctx.fillText('Reach the ★ to win!', 10, 45);

            // --- Draw Clear Message ---
            if (gameCleared) {
                // Semi-transparent overlay
                ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);

                // Clear text
                ctx.fillStyle = '#FFD93D';
                ctx.font = 'bold 80px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('CLEAR!', canvas.width / 2, canvas.height / 2);

                // Restart instruction
                ctx.fillStyle = 'white';
                ctx.font = '24px Arial';
                ctx.fillText('Press R to restart', canvas.width / 2, canvas.height / 2 + 50);
            }
        }

        // ============================================
        // RESTART FUNCTION
        // ============================================

        function restart() {
            // Reset player position and state
            player.x = 50;
            player.y = 500;
            player.velocityX = 0;
            player.velocityY = 0;
            player.isOnGround = false;
            gameCleared = false;
        }

        // Listen for restart key
        document.addEventListener('keydown', (event) => {
            if (event.code === 'KeyR' && gameCleared) {
                restart();
            }
        });

        // ============================================
        // GAME LOOP
        // ============================================

        function gameLoop() {
            update();   // Update game logic
            draw();     // Draw everything
            requestAnimationFrame(gameLoop); // Continue the loop
        }

        // Start the game!
        gameLoop();
    </script>
</body>
</html>
